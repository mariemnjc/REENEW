<div class="container mt-4">

  <!-- FORMULAIRE (nécessaire pour submit dans certains cas) -->
  <%= form_with url: salons_path, method: :get, local: true, class: "category-filter-form" do %>
    <%= hidden_field_tag :location, params[:location] %>

    <!-- 🖥️ DESKTOP FILTERS -->
    <div class="filter-bar-desktop d-none d-md-flex justify-content-between align-items-center mb-4">

      <!-- Faux Select dropup -->
      <div class="dropdown dropup w-50 me-2">
        <button class="btn btn-light dropdown-toggle w-100 border category-dropdown-btn" type="button" id="styleDropdown" data-bs-toggle="dropdown" aria-expanded="false">
          <%= params[:style].presence || "Tous" %>
        </button>

        <ul class="dropdown-menu w-100" aria-labelledby="styleDropdown">
          <% @service_categories.each do |category| %>
            <li>
              <%= link_to salons_path(style: category, location: params[:location]), class: "dropdown-item" do %>
                <%= category %>
              <% end %>
            </li>
          <% end %>
        </ul>
      </div>

      <!-- Bouton Carte -->
      <%= link_to "🗺️ Carte", map_salons_path, class: "btn btn-light border map-btn" %>
    </div>

    <!-- 📱 MOBILE BOTTOM BAR -->
    <div class="filter-bar-mobile d-md-none fixed-bottom bg-white shadow-lg p-2 d-flex justify-content-around border-top">

      <!-- Dropup Mobile -->
      <div class="dropdown dropup w-50">
        <button class="btn btn-light dropdown-toggle w-100 border category-dropdown-btn" type="button" id="styleDropdownMobile" data-bs-toggle="dropdown" aria-expanded="false">
          <%= params[:style].presence || "Tous" %>
        </button>

        <ul class="dropdown-menu w-100" aria-labelledby="styleDropdownMobile">
          <% @service_categories.each do |category| %>
            <li>
              <%= link_to salons_path(style: category, location: params[:location]), class: "dropdown-item" do %>
                <%= category %>
              <% end %>
            </li>
          <% end %>
        </ul>
      </div>

      <!-- Carte -->
      <%= link_to "🗺️ Carte", map_salons_path, class: "btn btn-primary w-45 text-white" %>
    </div>
  <% end %>

  <!-- 🧾 LISTE DES SALONS -->
  <div class="salon-container d-flex flex-wrap gap-4 justify-content-center mt-3">
    <% @salons.each do |salon| %>
      <%= link_to salon_path(salon), class: 'card-salon-modern text-decoration-none' do %>
        <div class="top-part">
          <% if salon.certified? %>
            <div class="certified-icon" data-tooltip="Certifié Reenew">
              <%= cl_image_tag("Logo_Reenew", crop: :fit, class: "certified-logo") %>
            </div>
          <% end %>

          <% if salon.photo.attached? %>
            <%= cl_image_tag salon.photo.key, width: 100, height: 100, crop: :fill, class: "salon-image" %>
          <% else %>
            <%= image_tag "https://pur-paris.com/wp-content/uploads/2023/01/image-2.webp", width: 100, height: 100, class: "salon-image" %>
          <% end %>
        </div>

        <div class="bottom-part">
          <h5 class="salon-title"><%= salon.name %></h5>
          <p class="salon-address"><%= salon.address %></p>
          <p class="salon-rating">
            <%= salon.average_rating || "—" %> <i class="fa-solid fa-star text-warning"></i>
          </p>
        </div>
      <% end %>
    <% end %>
  </div>
</div>
